services:
  PLD:
    image: ivangutierrrez/i-drone:1.0.0
    container_name: PLD
    network_mode: "host"
    volumes:
      - $HOME/.ssh:/tmp/.ssh:ro
      - $HOME/test/PLD/logs:/opt/I-Drone/logs
      - $HOME/test/PLD/data:/opt/I-Drone/data
      - ./entrypoint-pld.sh:/entrypoint.sh:ro
    entrypoint: ["/bin/bash", "/entrypoint.sh"]
    command: /opt/I-Drone/PLD --Own_Address 127.0.0.1 --Own_port 12345
    restart: unless-stopped

  Planner:
    image: ivangutierrrez/i-drone:1.0.0
    container_name: Planner
    network_mode: "host"
    volumes:
      - $HOME/test/Planner/logs:/opt/I-Drone/logs
      - $HOME/test/Planner/data:/opt/I-Drone/data
    command: /opt/I-Drone/Planner --PLD_Address 127.0.0.1 --PLD_port 12346
    restart: "no"

  Drone:
    image: ivangutierrrez/px4-sim-i-drone:1.0.0
    container_name: Drone
    network_mode: "host"
    privileged: true
    tty: true
    stdin_open: true
    env_file:
      - .env.drone
    environment:
      - DISPLAY=:0
      - QT_X11_NO_MITSHM=1
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - $HOME/test/Drone/logs:/opt/I-Drone/logs
      - $HOME/test/Drone/data:/opt/I-Drone/data
    command: >
      bash -c "/opt/I-Drone/start_gazebo.sh & 
      sleep 5 && 
      /opt/I-Drone/Drone --PLD_Address 127.0.0.1 --PLD_port 12347"
    restart: "no"

  Client:
    image: ivangutierrrez/i-drone-client:1.0.0
    container_name: Client
    network_mode: "host"
    volumes:
      - $HOME/test/Client/logs:/app/logs
      - $HOME/repo/I-Drone/I-Drone/Client/config/:/app/config/
      - $HOME/repo/I-Drone/I-Drone/Client/src/Config.py:/app/src/Config.py
    working_dir: /app/src
    command: python3 Client.py --offline
    restart: "no"